From: Juergen Beisert <jbe@pengutronix.de>
Subject: DHCP and NFSroot/TFTP

Setting up NFS root/TFTP related variables is successfull only if the network
interface is already configured. For the case someone is using DHCP, this
fails, because all these vars are still empty.

Signed off by: Juergen Beisert <jbe@pengutronix.de>

---
 arch/arm/boards/mini2440/env/config |    2 +-
 defaultenv/bin/boot                 |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

Index: barebox-2011.05.0/defaultenv/bin/boot
===================================================================
--- barebox-2011.05.0.orig/defaultenv/bin/boot
+++ barebox-2011.05.0/defaultenv/bin/boot
@@ -21,7 +21,7 @@ if [ x$ip = xdhcp ]; then
 elif [ x$ip = xnone ]; then
 	bootargs="$bootargs ip=none"
 else
-	bootargs="$bootargs ip=$eth0.ipaddr::$eth0.gateway:$eth0.netmask:::"
+	bootargs="$bootargs ip=$eth0.ipaddr:$eth0.serverip:$eth0.gateway:$eth0.netmask:::"
 fi
 
 
Index: barebox-2011.05.0/arch/arm/boards/mini2440/env/config
===================================================================
--- barebox-2011.05.0.orig/arch/arm/boards/mini2440/env/config
+++ barebox-2011.05.0/arch/arm/boards/mini2440/env/config
@@ -38,7 +38,7 @@ if [ -n $user ]; then
 	nfsroot="${eth0.serverip}:/home/${user}/nfsroot/${machine}"
 	rootfsimage="${user}"-"${rootfsimage}"
 else
-	nfsroot="${eth0.serverip}:/path/to/nfs/root"
+	nfsroot="/path/to/nfs/root"
 fi
 
 autoboot_timeout=3
